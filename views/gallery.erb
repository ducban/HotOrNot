<p>Using arrow keys to navigate between pages</p>
<p>Press '/' to change from navigate mode to move cursor mode</p>
<p>In move cursor mode, press 'enter' to go vote page</p>

<p>Page <%= @page %> has <%= @users.length %> pics</p>
<div id="container">
<% @users.each_with_index do |user,index| %>
<div class="item" id="item<%= index %>" userid="<%= user.id %>">
  <a href='/vote/<%= "%s/%s" % [@sex, user.id] %>'>
    <img src='<%= user.pic_square %>' title='<%= user.name %>' alt='<%= user.id %>' />
  </a>
</div>
<% end %>
</div>

<script type='text/javascript'>
var mode = 0; // naviagation mode
var row = 0;
var col = 0;

function gotoURL(link) {
  window.location = link;
}

function handleNavigationMode(e) {
  if(e.keyCode == 37 || e.keyCode == 72 || e.keyCode == 74) { // left
    var page = <%= @page.to_i %>;
    if (page > 1)
      gotoURL('<%= "/gallery/#{@sex}/#{@page - 1}" %>');
  }
  else if(e.keyCode == 39 || e.keyCode == 76 || e.keyCode == 75) { // right
    gotoURL('<%= "/gallery/#{@sex}/#{@page + 1}" %>');
  }
}

function min(x, y) {
  return x > y ? y : x;
}

function max(x, y) {
  return x > y ? x : y;
}

function getSelectedItem() {
  return $("#item" + (row * 10 + col));
}

function handleMoveMode(e) {
  getSelectedItem().removeClass("selected").addClass("item");
  if (e.keyCode == 72 || e.keyCode == 37) {  // h
    col = max(col - 1, 0);
  } else if (e.keyCode == 74 || e.keyCode == 40) { // j
    row = min(row + 1, 9);
  } else if (e.keyCode == 75 || e.keyCode == 38) { // k
    row = max(row - 1, 0);
  } else if (e.keyCode == 76 || e.keyCode == 39) { // l
    col = min(col + 1, 9);
  } else if (e.keyCode == 13) { // enter
    gotoURL('/vote/<%= @sex %>/' + getSelectedItem().attr('userid'));
  }
  getSelectedItem().removeClass("item").addClass("selected");
}

$("body").keydown(function(e) {
  if (mode == 0)
    handleNavigationMode(e);
  else if (mode == 1)
    handleMoveMode(e);

  if (e.keyCode == 191) {// '/' to change mode
    mode = 1 - mode;
    if (mode == 1) {
      getSelectedItem().removeClass("item").addClass("selected");
    } else {
      getSelectedItem().removeClass("selected").addClass("item");
    }
  } 
});

//getSelectedItem().removeClass("item").addClass("selected");
</script>

